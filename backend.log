Building...
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (4ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*) FROM "sqlite_master" WHERE "type" = 'table' AND "rootpage" IS NOT NULL;
FFmpeg functionality check: PASS
info: WebMusic.Backend.Services.ScanWorker[0]
      ScanWorker started.
info: Microsoft.Hosting.Lifetime[14]
      Now listening on: http://0.0.0.0:5098
info: Microsoft.Hosting.Lifetime[0]
      Application started. Press Ctrl+C to shut down.
info: Microsoft.Hosting.Lifetime[0]
      Hosting environment: Development
info: Microsoft.Hosting.Lifetime[0]
      Content root path: /Users/lilee/Projects/dev/WebMusic/v2/backend
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT EXISTS (
          SELECT 1
          FROM "Users" AS "u")
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[@__request_Username_0='?' (Size = 5)], CommandType='Text', CommandTimeout='30']
      SELECT "u"."Id", "u"."PasswordHash", "u"."Username"
      FROM "Users" AS "u"
      WHERE "u"."Username" = @__request_Username_0
      LIMIT 2
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "PlayHistories" AS "p"
      WHERE "p"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (2ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "MediaFiles" AS "m"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "Favorites" AS "f"
      WHERE "f"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM (
          SELECT DISTINCT "m"."Artist"
          FROM "MediaFiles" AS "m"
      ) AS "t"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM (
          SELECT DISTINCT "m"."Album"
          FROM "MediaFiles" AS "m"
      ) AS "t"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (6ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COALESCE(SUM("m"."SizeBytes"), 0)
      FROM "MediaFiles" AS "m"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "p"."MediaFileId", "p"."PlayedAt"
          FROM "PlayHistories" AS "p"
          WHERE "p"."UserId" = @__userId_0
          ORDER BY "p"."PlayedAt" DESC
          LIMIT @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."PlayedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "f"."CreatedAt", "f"."MediaFileId"
          FROM "Favorites" AS "f"
          WHERE "f"."UserId" = @__userId_0
          ORDER BY "f"."CreatedAt" DESC
          LIMIT @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."CreatedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "MediaFiles" AS "m"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "PlayHistories" AS "p"
      WHERE "p"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "Favorites" AS "f"
      WHERE "f"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM (
          SELECT DISTINCT "m"."Artist"
          FROM "MediaFiles" AS "m"
      ) AS "t"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM (
          SELECT DISTINCT "m"."Album"
          FROM "MediaFiles" AS "m"
      ) AS "t"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "p"."MediaFileId", "p"."PlayedAt"
          FROM "PlayHistories" AS "p"
          WHERE "p"."UserId" = @__userId_0
          ORDER BY "p"."PlayedAt" DESC
          LIMIT @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."PlayedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "f"."CreatedAt", "f"."MediaFileId"
          FROM "Favorites" AS "f"
          WHERE "f"."UserId" = @__userId_0
          ORDER BY "f"."CreatedAt" DESC
          LIMIT @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."CreatedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[], CommandType='Text', CommandTimeout='30']
      SELECT COALESCE(SUM("m"."SizeBytes"), 0)
      FROM "MediaFiles" AS "m"
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "Favorites" AS "f"
      WHERE "f"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "t"."MediaFileId", "t"."CreatedAt", "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "f"."CreatedAt", "f"."MediaFileId"
          FROM "Favorites" AS "f"
          WHERE "f"."UserId" = @__userId_0
          ORDER BY "f"."CreatedAt" DESC
          LIMIT @__p_2 OFFSET @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."CreatedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT COUNT(*)
      FROM "Favorites" AS "f"
      WHERE "f"."UserId" = @__userId_0
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__p_2='?' (DbType = Int32), @__p_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "t"."MediaFileId", "t"."CreatedAt", "m"."Id", "m"."Title", "m"."Artist", "m"."Album", "m"."Genre", "m"."Duration", "m"."FilePath"
      FROM (
          SELECT "f"."CreatedAt", "f"."MediaFileId"
          FROM "Favorites" AS "f"
          WHERE "f"."UserId" = @__userId_0
          ORDER BY "f"."CreatedAt" DESC
          LIMIT @__p_2 OFFSET @__p_1
      ) AS "t"
      INNER JOIN "MediaFiles" AS "m" ON "t"."MediaFileId" = "m"."Id"
      ORDER BY "t"."CreatedAt" DESC
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__mediaId_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "p"."Id", "p"."MediaFileId", "p"."PlayedAt", "p"."UserId"
      FROM "PlayHistories" AS "p"
      WHERE "p"."UserId" = @__userId_0 AND "p"."MediaFileId" = @__mediaId_1
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."AddedAt", "m"."Album", "m"."Artist", "m"."Duration", "m"."FileHash", "m"."FilePath", "m"."Genre", "m"."ParentPath", "m"."ScanSourceId", "m"."SizeBytes", "m"."Title", "m"."Year", "s"."Id", "s"."Name", "s"."Path", "s"."StorageCredentialId", "s"."Type", "s0"."Id", "s0"."AuthData", "s0"."Host", "s0"."Name", "s0"."ProviderType"
      FROM "MediaFiles" AS "m"
      INNER JOIN "ScanSources" AS "s" ON "m"."ScanSourceId" = "s"."Id"
      LEFT JOIN "StorageCredentials" AS "s0" ON "s"."StorageCredentialId" = "s0"."Id"
      WHERE "m"."Id" = @__id_0
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      UPDATE "PlayHistories" SET "MediaFileId" = @p0, "PlayedAt" = @p1, "UserId" = @p2
      WHERE "Id" = @p3
      RETURNING 1;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__mediaId_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "p"."Id", "p"."MediaFileId", "p"."PlayedAt", "p"."UserId"
      FROM "PlayHistories" AS "p"
      WHERE "p"."UserId" = @__userId_0 AND "p"."MediaFileId" = @__mediaId_1
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      UPDATE "PlayHistories" SET "MediaFileId" = @p0, "PlayedAt" = @p1, "UserId" = @p2
      WHERE "Id" = @p3
      RETURNING 1;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."AddedAt", "m"."Album", "m"."Artist", "m"."Duration", "m"."FileHash", "m"."FilePath", "m"."Genre", "m"."ParentPath", "m"."ScanSourceId", "m"."SizeBytes", "m"."Title", "m"."Year", "s"."Id", "s"."Name", "s"."Path", "s"."StorageCredentialId", "s"."Type", "s0"."Id", "s0"."AuthData", "s0"."Host", "s0"."Name", "s0"."ProviderType"
      FROM "MediaFiles" AS "m"
      INNER JOIN "ScanSources" AS "s" ON "m"."ScanSourceId" = "s"."Id"
      LEFT JOIN "StorageCredentials" AS "s0" ON "s"."StorageCredentialId" = "s0"."Id"
      WHERE "m"."Id" = @__id_0
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@__userId_0='?' (DbType = Int32), @__mediaId_1='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "p"."Id", "p"."MediaFileId", "p"."PlayedAt", "p"."UserId"
      FROM "PlayHistories" AS "p"
      WHERE "p"."UserId" = @__userId_0 AND "p"."MediaFileId" = @__mediaId_1
      LIMIT 1
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (0ms) [Parameters=[@p3='?' (DbType = Int32), @p0='?' (DbType = Int32), @p1='?' (DbType = DateTime), @p2='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      UPDATE "PlayHistories" SET "MediaFileId" = @p0, "PlayedAt" = @p1, "UserId" = @p2
      WHERE "Id" = @p3
      RETURNING 1;
info: Microsoft.EntityFrameworkCore.Database.Command[20101]
      Executed DbCommand (1ms) [Parameters=[@__id_0='?' (DbType = Int32)], CommandType='Text', CommandTimeout='30']
      SELECT "m"."Id", "m"."AddedAt", "m"."Album", "m"."Artist", "m"."Duration", "m"."FileHash", "m"."FilePath", "m"."Genre", "m"."ParentPath", "m"."ScanSourceId", "m"."SizeBytes", "m"."Title", "m"."Year", "s"."Id", "s"."Name", "s"."Path", "s"."StorageCredentialId", "s"."Type", "s0"."Id", "s0"."AuthData", "s0"."Host", "s0"."Name", "s0"."ProviderType"
      FROM "MediaFiles" AS "m"
      INNER JOIN "ScanSources" AS "s" ON "m"."ScanSourceId" = "s"."Id"
      LEFT JOIN "StorageCredentials" AS "s0" ON "s"."StorageCredentialId" = "s0"."Id"
      WHERE "m"."Id" = @__id_0
      LIMIT 1
